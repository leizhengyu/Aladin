import urllibimport urllib3,certifiimport jsonimport reimport lxml.etreeimport lxml.html as x# 1. start and connect to serverjs=json.loads('{"KEYS":"净化器",         \                "BASE":{"http": "http://s.1688.com","Headers":"content=IE9","path":"/selloffer/offer_search.htm?keywords="}, \                "PATH":[{"xpath":"<a><b><c><d>","action":"open/parse"},    \                        {"xpath":"asdf","action":"parse"},                 \                        {"xpath":"asdf","action":"parse"}]}')# 2. create thead and send message keywords = js['KEYS']baseaddr = js['BASE']xpaths   = js['PATH']pool = urllib3.PoolManager(cert_reqs='CERT_REQUIRED', ca_certs=certifi.where())rsp = pool.request("GET",baseaddr['http']);ct=rsp.headers['Content-Type']regex = re.compile(r'.*; charset=(\w+)')match=regex.match(ct)if match :    charset=match.group(1)else:    charset='utf-8'headers = {'User-Agent':'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET4.0C; .NET4.0E)'}url = baseaddr['http'] + baseaddr['path'] +  urllib.parse.quote(keywords.encode(charset))rsp = pool.request("GET",url,headers=headers)##url='http://s.1688.com/selloffer/offer_search.htm?keywords=%BE%BB%BB%AF%C6%F7'##http = urllib3.PoolManager(cert_reqs='CERT_REQUIRED', ca_certs=certifi.where())##rsp = http.request('GET',url)##print(rsp.data.decode("gbk"))doc = lxml.html.document_fromstring(rsp.data)alist=doc.xpath('//a[@class="sm-offer-photoLink sw-dpl-offer-photoLink"]')for a in alist:    url=a.attrib['href']    print(url)    rsp=pool.request("GET",url,headers=headers)    print(rsp.data)    doc=lxml.html.document_fromstring(rsp.data)    url=doc.xpath('//li[@data-page-name="contactinfo"]/a')[0].attrib['href']    rsp=pool.request("GET",url,headers=headers)    doc=x.document_fromstring(rsp.data)    contactname=doc.xpath('//div[@class="contact-info"]/dl/dd/a')[0].text    print(contactname)    contactdesc=doc.xpath('//div[@class="contcat-desc"]/dl/dd')    for desc in contactdesc:        print(desc.text)#class Spider:#   #def __init__(self):#       #self.siteURL = 'http://www.1688.com/'###   #def OpenUrl(self,url):###       ###a=xcrawler.PageScraper()#       ###GET /selloffer/offer_search.htm?keywords=%CE%DE%C8%CB%BB%FA&n=y&spm=a260k.635.1998096057.d1 HTTP/1.1       ##http://s.1688.com/selloffer/offer_search.htm?keywords=%BE%BB%BB%AF%C6%F7       ##http://s.1688.com/selloffer/offer_search.html?keywords=%25BE%25BB%25BB%25AF%25C6%25F7##       #params = urllib.parse.quote(('净化器').encode("gbk"))       #url = 'http://s.1688.com/selloffer/offer_search.htm?keywords=%s'%params                 ##http://s.1688.com/selloffer/offer_search.htm?keywords=%BE%BB%BB%AF%C6%F7&button_click=top&earseDirect=false&n=y       #print(url)###url = baseaddr['http'] + baseaddr['path'] +  urllib.parse.quote(keywords.encode("gbk"))###url = "http://detail.1688.com/offer/44300264955.html?tracelog=p4p"##print(url)###headers = {'User-Agent':'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET4.0C; .NET4.0E)', 'Accept':'application/xaml+xml'}##http = urllib3.PoolManager(cert_reqs='CERT_REQUIRED', ca_certs=certifi.where())##r = http.request('GET',url)##print(r.headers)##print(r.data.decode("gbk"))#              ##response = urllib3.urlopen(request)#print(r.data.decode('gbk'))###   #def SetParams(self,pageIndex):#       #page = self.OpenUrl('')#       #print(page)#####   #def GetPage(self):#       #pass#   #def Parse(self,xpath):#       #pass#   #def GetInfo(self):#       #pass#spider = Spider()#spider.SetParams('')